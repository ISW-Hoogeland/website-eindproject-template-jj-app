<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>CoÃ¶rdineren Hulp - Noodhulp App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="top-nav">
    <a href="quiz.html" class="btn-top btn-trainen">Trainen</a>
    <img src="images/logo.png" alt="Noodhulp App Logo" class="app-logo">
    <a href="tel:112" class="btn-top btn-112">ğŸ“ 112</a>
</nav>

<main class="main-content coordinatie-page">
    <h2>Stappenplan CoÃ¶rdineren & Omgeven</h2>
    
    <div class="step-container" id="stepContainer">
        <!-- Stappen worden ingevuld door JavaScript -->
    </div>
    
    <div class="step-buttons">
        <button onclick="previousStep()" class="step-btn" id="prevBtn">â† Vorige</button>
        <button onclick="nextStep()" class="step-btn" id="nextBtn">Check â†’</button>
    </div>
</main>

<div class="action-bar">
    <button class="icon-btn" onclick="alert('Info over de app')">â“˜</button>
    <div class="location-box">
        <i>ğŸ“</i>
        Uw locatie<br><strong>Professorslaan 20</strong>
    </div>
    <button class="icon-btn" onclick="toggleFlashlight()">ğŸ”¦</button>
    <button class="icon-btn" onclick="toggleDarkMode()">ğŸŒ“</button>
</div>

<nav class="bottom-nav">
    <a href="index.html" class="btn-top nav-item"><span>ğŸ </span>Home</a>
    <button class="icon-btn" onclick="toggleFlashlight()">ğŸ”¦</button>
    <button class="icon-btn" onclick="toggleDarkMode()">ğŸŒ“</button>
    <a href="kaart.html" class="btn-top nav-item"><span>ğŸ—ºï¸</span>AED Kaart</a>
</nav>

<script>
    let currentStep = 1;
    const totalSteps = 7;
    
    const steps = [
        {
            title: "Situatie waarderen en doorgeven",
            description: "Beoordeel de plaats van het ongeval (zie locatie onderin) en aantal slachtoffers."
        },

        {
            title: "Informatie doorgeven",
            description: "Zorg dat hulpverleners alle informatie hebben."
        },

        {
            title: "Afzetten",
            description: "blokkeer de plek van ongeluk zodat je veilig hulp kunt verlenen."
        },
        {
            title: "Verkeer reguleren",
            description: "Houd verkeer op veilige afstand met handgebaren en probeer het door te laten stromen."
        },
        {
            title: "Omstanders wegwijs",
            description: "Stuur omstanders naar veilige plek, vraag hulp wanneer nodig."
        },

        {
            title: "Controleer doorgang",
            description: "Zorg dat wegen vrij blijven voor hulpdiensten."
        },
    
        {
            title: "Hulpverleners geleiden",
            description: "Wijs ambulance/brandweer naar plek van ongeluk."
        }
        
    ];
    
    function displayStep() {
        const stepContainer = document.getElementById('stepContainer');
        const step = steps[currentStep - 1];
        
        stepContainer.innerHTML = `
            <div class="step-box">
                <p class="step-number">STAP ${currentStep} VAN ${totalSteps}</p>
                <h3 class="step-title">${step.title}</h3>
                <p class="step-description">${step.description}</p>
            </div>
        `;
        
        // Update buttons visibility
        const prevBtn = document.getElementById('prevBtn');
        if (currentStep > 1) {
            prevBtn.style.display = 'inline-block';
        } else {
            prevBtn.style.display = 'none';
        }
        document.getElementById('nextBtn').innerText = currentStep === totalSteps ? 'Klaar!' : 'Check â†’';
    }
    
    function nextStep() {
        if (currentStep < totalSteps) {
            currentStep++;
            displayStep();
        } else if (currentStep === totalSteps) {
            alert('Je hebt alle stappen voltooid!');
        }
    }
    
    function previousStep() {
        if (currentStep > 1) {
            currentStep--;
            displayStep();
        }
    }
    
    let flashlightStream = null;
    let flashlightTrack = null;

    function toggleDarkMode() { document.body.classList.toggle("dark"); }
    async function toggleFlashlight() { 
        try {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('Zaklamp niet ondersteund op deze browser.');
                return;
            }

            if (flashlightTrack) {
                try {
                    await flashlightTrack.applyConstraints({ advanced: [{ torch: false }] });
                    flashlightTrack.stop();
                    flashlightStream.getTracks().forEach(track => track.stop());
                    flashlightTrack = null;
                    flashlightStream = null;
                } catch (e) {
                    console.error('Error turning off flashlight:', e);
                }
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        advanced: [{ torch: true }]
                    }
                });
                flashlightStream = stream;
                flashlightTrack = stream.getVideoTracks()[0];
            } catch (e) {
                console.log('Trying alternative method for flashlight...');
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities ? track.getCapabilities() : {};
                if (capabilities.torch) {
                    try {
                        await track.applyConstraints({ advanced: [{ torch: true }] });
                        flashlightStream = stream;
                        flashlightTrack = track;
                    } catch (constraintErr) {
                        track.stop();
                        stream.getTracks().forEach(t => t.stop());
                        alert('Zaklamp kan niet worden ingeschakeld op dit apparaat.');
                        return;
                    }
                } else {
                    track.stop();
                    stream.getTracks().forEach(t => t.stop());
                    alert('Zaklamp niet beschikbaar op dit apparaat.');
                    return;
                }
            }
        } catch (error) {
            console.error('Zaklamp fout:', error);
            if (error.name === 'NotAllowedError') {
                alert('Zaklamp toestemming geweigerd. Zet dit in je instellingen aan.');
            } else if (error.name === 'NotFoundError') {
                alert('Camera niet gevonden op dit apparaat.');
            } else {
                alert('Kan de zaklamp niet inschakelen. Mogelijke oorzaken: geen camera, geen toestemming, of onvoldoende Android versie (minimaal Android 5).');
            }
        }
    }
    
    // Start displaying first step
    displayStep();
</script>
</body>
</html>
