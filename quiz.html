<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Quiz - Noodhulp App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="top-nav">
    <div class="nav-left">
        <select id="languageSelect" class="btn-lang" onchange="changeLanguage(this.value)">
            <option value="nl">ğŸ‡³ğŸ‡±</option>
            <option value="en">ğŸ‡¬ğŸ‡§</option>
            <option value="de">ğŸ‡©ğŸ‡ª</option>
            <option value="fr">ğŸ‡«ğŸ‡·</option>
            <option value="es">ğŸ‡ªğŸ‡¸</option>
        </select>
        <a href="quiz.html" class="btn-top btn-trainen" data-i18n="train">Trainen</a>
    </div>
    <img src="images/logo.png" alt="Noodhulp App Logo" class="app-logo">
    <div class="nav-right">
        <a href="tel:112" class="btn-top btn-112" data-i18n="call112">ğŸ“ 112</a>
        <button class="info-btn" onclick="showInfo()" data-i18n="info">â„¹ï¸</button>
    </div>
</nav>

<main class="main-content">
    <div id="quiz-screen">
        <div class="progress-bar"><span id="progress-prefix">Vraag</span> <span id="current-idx">1</span> <span id="progress-middle">van</span> 20</div>
        <div id="question" class="question-text">Laden...</div>
        <div id="options" class="options-grid"></div>
        <div id="feedback" class="feedback-box"></div>
        <button id="next-button" class="next-btn" onclick="nextQuestion()" data-i18n="next_question">Volgende Vraag</button>
    </div>

    <div id="result-screen" style="display: none; text-align: center;">
        <h2 data-i18n="result_header">Resultaat</h2>
        <p style="font-size: 2rem; font-weight: bold;"><span id="final-score">0</span> / 20</p>
        <p id="score-message"></p>
        <button class="option-btn" style="text-align: center; width: 100%;" onclick="location.reload()" data-i18n="retry">Opnieuw starten</button>
    </div>
</main>

<div class="action-bar">
    <button class="icon-btn" onclick="alert('EHBO Quiz v1.0')">â“˜</button>
    <div class="location-box">ğŸ“ Uw locatie<br><strong>Professorslaan 20</strong></div>
    <button class="icon-btn" onclick="toggleFlashlight()">ğŸ”¦
        <span class="icon-label">Zaklamp</span>
    </button>
    <button class="icon-btn" onclick="toggleDarkMode()">ğŸŒ“
        <span class="icon-label">Dark mode</span>
    </button>
</div>

<nav class="bottom-nav">
    <a href="index.html" class="btn-top nav-item"><span>ğŸ </span>Home</a>
    <button class="icon-btn" onclick="toggleFlashlight()">
        <span class="nav-icon">ğŸ”¦</span>
        <span class="nav-text" data-i18n="flashlight">Zaklamp</span>
    </button>
    <button class="icon-btn" onclick="toggleDarkMode()">
        <span class="nav-icon">ğŸŒ“</span>
        <span class="nav-text" data-i18n="darkmode">Dark mode</span>
    </button>
    <a href="kaart.html" class="btn-top nav-item"><span>ğŸ—ºï¸</span>AED Kaart</a>
    <button class="btn-top nav-item" onclick="openProfilePanel()"><span>ğŸ‘¤</span>Mijn Gegevens</button>
</nav>

<!-- profielpaneel -->
<div id="profile-panel" class="profile-panel" aria-hidden="true">
    <div class="panel-header">
        <h2>Mijn Gegevens</h2>
        <button class="close-btn" onclick="closeProfilePanel()" aria-label="Sluiten">âœ–ï¸</button>
    </div>
    <div class="panel-body">
        <label>Naam
            <input id="profile-name" type="text">
        </label>
        <label>Adres
            <input id="profile-address" type="text">
        </label>
        <label>AllergieÃ«n
            <input id="profile-allergies" type="text">
        </label>
        <label>Bloedgroep
            <input id="profile-blood" type="text">
        </label>
    </div>
</div>

<script>
    // De 20 vragen database
    const questions = [
        { q: "Wat is de allereerste stap bij hulpverlening?", a: ["112 bellen", "Veiligheid controleren", "Slachtoffer aanspreken", "Reanimeren"], correct: 1, expl: "Veiligheid voor jezelf en anderen is de absolute basis voordat je iets anders doet." },
        { q: "Wat is de verhouding reanimatie bij volwassenen?", a: ["15:2", "30:2", "30:5", "10:1"], correct: 1, expl: "30 borstcompressies en 2 beademingen is de standaard richtlijn." },
        { q: "Wat doe je bij een ernstige bloeding?", a: ["Schoonmaken", "Druk uitoefenen", "Lichaamsdeel omlaag", "Pleister plakken"], correct: 1, expl: "Druk uitoefenen stopt het bloedverlies en voorkomt shock." },
        { q: "Hoe behandel je een brandwond?", a: ["Boter erop", "Ijs erop", "Lauw stromend water", "Tandpasta"], correct: 2, expl: "Minstens 10-20 minuten koelen met lauw water is het beste." },
        { q: "Waarvoor dient de stabiele zijligging?", a: ["Comfort", "Luchtweg vrijhouden", "Bloeddruk verhogen", "Tegen rugpijn"], correct: 1, expl: "Het voorkomt dat de tong de luchtweg blokkeert of dat iemand stikt in braaksel." },
        { q: "Wat doe je bij verslikking als rugslagen niet werken?", a: ["Water geven", "Heimlich-greep", "Laten liggen", "Hard laten hoesten"], correct: 1, expl: "Buikstoten (Heimlich) verhogen de druk in de borstkas om het voorwerp uit te stoten." },
        { q: "Wat is de eerste actie bij een AED?", a: ["Stickers plakken", "Aanzetten", "Borstkas scheren", "Schok geven"], correct: 1, expl: "Zodra de AED aanstaat, geeft deze gesproken instructies." },
        { q: "Hoe herken je een beroerte (FAST)?", a: ["Honger", "Scheve mond/lamme arm", "Hoofdpijn", "Pijn in benen"], correct: 1, expl: "Face (mond), Arm (krachtverlies), Speech (spraak) en Time (tijd) zijn cruciaal." },
        { q: "Wat doe je bij een bloedneus?", a: ["Hoofd achterover", "Licht voorover en neus dicht", "Watjes diep erin", "Plat gaan liggen"], correct: 1, expl: "De zogenaamde 'schrijfhouding' voorkomt dat bloed in de maag komt." },
        { q: "Hoe diep moet je de borstkas indrukken?", a: ["2 cm", "5 tot 6 cm", "10 cm", "Niet te diep"], correct: 1, expl: "Dit is nodig om het bloed effectief rond te pompen bij een volwassene." },
        { q: "Wat is het ritme van reanimatie?", a: ["60 bpm", "100-120 bpm", "150 bpm", "Elke seconde"], correct: 1, expl: "Denk aan het ritme van 'Stayin Alive'." },
        { q: "Wanneer stop je met reanimatie?", a: ["Na 5 minuten", "Als de hulpdiensten het overnemen", "Als je moe bent", "Nooit"], correct: 1, expl: "Alleen als professionele hulp het overneemt of als het slachtoffer weer tekenen van leven vertoont." },
        { q: "AED stickers op een kind?", a: ["Altijd volwassen stickers", "Kinderelektroden indien beschikbaar", "Niet gebruiken", "Op de benen"], correct: 1, expl: "Kinderelektroden passen de stroomsterkte aan voor kleinere lichamen." },
        { q: "Wat doe je bij vergiftiging via de mond?", a: ["Laten braken", "Melk drinken", "Mond spoelen en 112 bellen", "Niets doen"], correct: 2, expl: "Braken kan de slokdarm extra beschadigen. Volg instructies van experts." },
        { q: "Wat is shock?", a: ["Bang zijn", "Tekort aan bloedvolume/druk", "Heel hard gillen", "Flauwvallen"], correct: 1, expl: "Shock is een medische noodsituatie waarbij organen te weinig bloed krijgen." },
        { q: "Iemand heeft een voorwerp in de wond?", a: ["Eruit trekken", "Laten zitten en fixeren", "Schoonmaken", "Dieper duwen"], correct: 1, expl: "Het voorwerp kan de bloeding deels stelpen; verwijderen kan een bloedbad veroorzaken." },
        { q: "Kleur van de huid bij shock?", a: ["Rood", "Blauw", "Bleek en klam", "Geel"], correct: 2, expl: "Het lichaam trekt bloed weg uit de huid naar vitale organen." },
        { q: "Wat doe je bij een zonnesteek?", a: ["In de zon blijven", "Koelen en vocht toedienen", "Heet douchen", "Hard rennen"], correct: 1, expl: "Verplaats het slachtoffer naar de schaduw en koel het lichaam af." },
        { q: "Wat zeg je tegen 112?", a: ["Alleen je naam", "Locatie, wat er gebeurd is, aantal slachtoffers", "Niets, zij weten alles", "Dat je bang bent"], correct: 1, expl: "Duidelijke informatie helpt de centralist de juiste hulp te sturen." },
        { q: "Wie heeft de leiding bij een ongeval?", a: ["De luidste persoon", "De eerste professionele hulpverlener", "Niemand", "De politie pas na een uur"], correct: 1, expl: "Zodra ambulance of politie er is, nemen zij de coÃ¶rdinatie over." }
    ];

    let currentQ = 0;
    let score = 0;

    function loadQuestion() {
        const qData = questions[currentQ];
        document.getElementById("current-idx").innerText = currentQ + 1;
        // update progress prefixes in case language changed
        document.getElementById("progress-prefix").textContent = translations[currentLang]?.progress_prefix || "Vraag";
        document.getElementById("progress-middle").textContent = translations[currentLang]?.progress_middle || "van";
        document.getElementById("question").innerText = qData.q;
        const optionsDiv = document.getElementById("options");
        optionsDiv.innerHTML = "";
        document.getElementById("feedback").style.display = "none";
        document.getElementById("next-button").style.display = "none";
        document.getElementById("next-button").textContent = translations[currentLang]?.next_question || "Volgende Vraag";

        qData.a.forEach((text, index) => {
            const btn = document.createElement("button");
            btn.classList.add("option-btn");
            btn.innerText = text;
            btn.onclick = () => selectOption(index);
            optionsDiv.appendChild(btn);
        });
    }

    function selectOption(index) {
        const qData = questions[currentQ];
        const feedback = document.getElementById("feedback");
        const buttons = document.querySelectorAll(".option-btn");
        buttons.forEach(btn => btn.disabled = true);

        if (index === qData.correct) {
            score++;
            buttons[index].style.backgroundColor = "var(--primary-green)";
            buttons[index].style.color = "white";
            feedback.className = "feedback-box correct";
            feedback.innerHTML = "<strong>Correct!</strong><br>" + qData.expl;
        } else {
            buttons[index].style.backgroundColor = "var(--primary-red)";
            buttons[index].style.color = "white";
            feedback.className = "feedback-box incorrect";
            feedback.innerHTML = "<strong>Fout.</strong> Het juiste antwoord was: " + qData.a[qData.correct] + "<br><br>" + qData.expl;
        }
        feedback.style.display = "block";
        document.getElementById("next-button").style.display = "block";
    }

    function nextQuestion() {
        currentQ++;
        if (currentQ < questions.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        const map = translations[currentLang] || translations['nl'];
        document.getElementById("quiz-screen").style.display = "none";
        document.getElementById("result-screen").style.display = "block";
        document.getElementById("final-score").innerText = score;
        let msg = score >= 15 ? map.score_message_good : map.score_message_bad;
        document.getElementById("score-message").innerText = msg;
        document.getElementById("next-button").textContent = map.retry;
    }

    let flashlightStream = null;
    let flashlightTrack = null;

    // Herstel dark mode instellingen bij page load
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
    }
    if (localStorage.getItem('flashlight') === 'true') {
        document.body.style.filter = 'invert(1)';
    }

    // Taal en vertalingen
    let currentLang = localStorage.getItem('language') || 'nl';
    const translations = {
        nl:{train:'Trainen',call112:'ğŸ“ 112',home:'Home',flashlight:'Zaklamp',darkmode:'Donker',aedmap:'AED Kaart',infoTitle:'Noodhulp App â€” versie 1.0',infoBody:'Gebruik deze app voor EHBO snelhulp en navigatie.',
             progress_prefix:'Vraag',progress_middle:'van',loading:'Laden...',next_question:'Volgende Vraag',score_message_good:'Geweldig! Je bent goed voorbereid.',score_message_bad:'Blijf oefenen, EHBO is belangrijk!',result_header:'Resultaat',retry:'Opnieuw starten'},
        en:{train:'Training',call112:'ğŸ“ 112',home:'Home',flashlight:'Flashlight',darkmode:'Dark mode',aedmap:'AED Map',infoTitle:'Emergency App â€” v1.0',infoBody:'Use this app for quick first aid and navigation.',
             progress_prefix:'Question',progress_middle:'of',loading:'Loading...',next_question:'Next Question',score_message_good:'Great! You are well prepared.',score_message_bad:'Keep practicing, first aid is important!',result_header:'Result',retry:'Retry'},
        de:{train:'Training',call112:'ğŸ“ 112',home:'Start',flashlight:'Taschenlampe',darkmode:'Nachtmodus',aedmap:'AED Karte',infoTitle:'Notfall-App â€” v1.0',infoBody:'Verwenden Sie diese App fÃ¼r Erste Hilfe und Navigation.',
             progress_prefix:'Frage',progress_middle:'von',loading:'Laden...',next_question:'NÃ¤chste Frage',score_message_good:'GroÃŸartig! Du bist gut vorbereitet.',score_message_bad:'Ãœbe weiter, Erste Hilfe ist wichtig!',result_header:'Ergebnis',retry:'Erneut starten'},
        fr:{train:'EntraÃ®nement',call112:'ğŸ“ 112',home:'Accueil',flashlight:'Lampe de poche',darkmode:'Mode sombre',aedmap:'Carte AED',infoTitle:'Application dâ€™urgence â€” v1.0',infoBody:'Utilisez cette application pour les premiers secours et la navigation.',
             progress_prefix:'Question',progress_middle:'sur',loading:'Chargement...',next_question:'Question suivante',score_message_good:'GÃ©nialâ€¯! Vous Ãªtes bien prÃ©parÃ©.',score_message_bad:'Continuez Ã  vous entraÃ®ner, premiers secours sont importants!',result_header:'RÃ©sultat',retry:'RÃ©essayer'},
        es:{train:'Entrenamiento',call112:'ğŸ“ 112',home:'Inicio',flashlight:'Linterna',darkmode:'Modo oscuro',aedmap:'Mapa AED',infoTitle:'App de emergencia â€” v1.0',infoBody:'Usa esta app para primeros auxilios y navegaciÃ³n.',
             progress_prefix:'Pregunta',progress_middle:'de',loading:'Cargando...',next_question:'Siguiente pregunta',score_message_good:'Â¡Genial! EstÃ¡s bien preparado.',score_message_bad:'Sigue practicando, los primeros auxilios son importantes!',result_header:'Resultado',retry:'Reintentar'}
    };
    function applyTranslations(lang){
        const map=translations[lang]||translations['nl'];
        document.documentElement.lang=lang;
        document.querySelectorAll('[data-i18n]').forEach(el=>{
            const key=el.getAttribute('data-i18n');
            if(map[key]){
                if(el.tagName==='INPUT'&&'placeholder' in el){
                    el.placeholder=map[key];
                } else {
                    el.textContent=map[key];
                }
            }
        });
    }
    const savedLang = localStorage.getItem('language') || currentLang;
    currentLang = savedLang;
    applyTranslations(currentLang);
    window.addEventListener('load', function(){
        const langSelect = document.getElementById('languageSelect');
        if(langSelect) langSelect.value = currentLang;
    });
    function changeLanguage(code){
        localStorage.setItem('language', code);
        currentLang = code;
        applyTranslations(code);
        if (typeof loadQuestion === 'function') {
            loadQuestion();
        }
    }
    function showInfo(){
        const map = translations[currentLang]||translations['nl'];
        alert(map.infoTitle+"\n"+map.infoBody);
    }
    // --- profiel panel scripts ---
    function openProfilePanel() {
        document.getElementById('profile-panel').classList.add('open');
    }

    function closeProfilePanel() {
        document.getElementById('profile-panel').classList.remove('open');
    }

    function loadProfile() {
        const data = JSON.parse(localStorage.getItem('profile') || '{}');
        document.getElementById('profile-name').value = data.name || '';
        document.getElementById('profile-address').value = data.address || '';
        document.getElementById('profile-allergies').value = data.allergies || '';
        document.getElementById('profile-blood').value = data.blood || '';
    }

    function saveProfile() {
        const data = {
            name: document.getElementById('profile-name').value,
            address: document.getElementById('profile-address').value,
            allergies: document.getElementById('profile-allergies').value,
            blood: document.getElementById('profile-blood').value
        };
        localStorage.setItem('profile', JSON.stringify(data));
    }

    window.addEventListener('DOMContentLoaded', function() {
        if (typeof loadProfile === 'function') {
            loadProfile();
            const inputs = document.querySelectorAll('#profile-panel input');
            inputs.forEach(i => i.addEventListener('input', saveProfile));
        }
    });
    function toggleDarkMode() { 
        document.body.classList.toggle("dark-mode");
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    
    async function toggleFlashlight() { 
        try {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('Zaklamp niet ondersteund op deze browser.');
                return;
            }

            if (flashlightTrack) {
                try {
                    await flashlightTrack.applyConstraints({ advanced: [{ torch: false }] });
                    flashlightTrack.stop();
                    flashlightStream.getTracks().forEach(track => track.stop());
                    flashlightTrack = null;
                    flashlightStream = null;
                } catch (e) {
                    console.error('Error turning off flashlight:', e);
                }
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        advanced: [{ torch: true }]
                    }
                });
                flashlightStream = stream;
                flashlightTrack = stream.getVideoTracks()[0];
            } catch (e) {
                console.log('Trying alternative method for flashlight...');
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities ? track.getCapabilities() : {};
                if (capabilities.torch) {
                    try {
                        await track.applyConstraints({ advanced: [{ torch: true }] });
                        flashlightStream = stream;
                        flashlightTrack = track;
                    } catch (constraintErr) {
                        track.stop();
                        stream.getTracks().forEach(t => t.stop());
                        alert('Zaklamp kan niet worden ingeschakeld op dit apparaat.');
                        return;
                    }
                } else {
                    track.stop();
                    stream.getTracks().forEach(t => t.stop());
                    alert('Zaklamp niet beschikbaar op dit apparaat.');
                    return;
                }
            }
        } catch (error) {
            console.error('Zaklamp fout:', error);
            if (error.name === 'NotAllowedError') {
                alert('Zaklamp toestemming geweigerd. Zet dit in je instellingen aan.');
            } else if (error.name === 'NotFoundError') {
                alert('Camera niet gevonden op dit apparaat.');
            } else {
                alert('Kan de zaklamp niet inschakelen. Mogelijke oorzaken: geen camera, geen toestemming, of onvoldoende Android versie (minimaal Android 5).');
            }
        }
    }
    loadQuestion();
</script>
</body>
</html>