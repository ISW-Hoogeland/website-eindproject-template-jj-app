<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Noodhulp App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="top-nav">
    <div class="nav-left">
        <select id="languageSelect" class="btn-lang" onchange="changeLanguage(this.value)">
            <option value="nl">ğŸ‡³ğŸ‡± Nederlands</option>
            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        </select>
        <a href="quiz.html" class="btn-top btn-trainen" data-i18n="train">Trainen</a>
    </div>
    <img src="images/logo.png" alt="Noodhulp App Logo" class="app-logo">
    <div class="nav-right">
        <a href="tel:112" class="btn-top btn-112" data-i18n="call112">ğŸ“ 112</a>
        <button class="info-btn" onclick="showInfo()" data-i18n="info">â„¹ï¸</button>
    </div>
</nav>

<main class="main-content victim-page">
    <h2>Stappenplan: PatiÃ«nt in Leven Houden</h2>
    
    <div class="step-container" id="stepContainer">
        <!-- Stappen worden ingevuld door JavaScript -->
    </div>
    
    <div class="step-buttons">
        <button onclick="previousStep()" class="step-btn" id="prevBtn">â† Vorige</button>
        <button onclick="nextStep()" class="step-btn" id="nextBtn">Check â†’</button>
        <div id="breathingButtons" style="display: none;">
            <button onclick="breathingResult(true)" class="step-btn step-btn-yes">Ja, ademt â†’</button>
            <button onclick="breathingResult(false)" class="step-btn step-btn-no">Nee, ademt niet â†’</button>
        </div>
    </div>
</main>

<div class="action-bar">
    <button class="icon-btn" onclick="alert('Info over de app')">â“˜</button>
    <div class="location-box">
        <i>ğŸ“</i>
        Uw locatie<br><strong>Professorslaan 20</strong>
    </div>
    <button class="icon-btn" onclick="toggleFlashlight()">ğŸ”¦
        <span class="icon-label">Zaklamp</span>
    </button>
    <button class="icon-btn" onclick="toggleDarkMode()">ğŸŒ“
        <span class="icon-label">Dark mode</span>
    </button>
</div>

<nav class="bottom-nav">
    <a href="index.html" class="btn-top nav-item"><span>ğŸ </span>Home</a>
    <button class="icon-btn" onclick="toggleFlashlight()">
        <span class="nav-icon">ğŸ”¦</span>
        <span class="nav-text" data-i18n="flashlight">Zaklamp</span>
    </button>
    <button class="icon-btn" onclick="toggleDarkMode()">
        <span class="nav-icon">ğŸŒ“</span>
        <span class="nav-text" data-i18n="darkmode">Dark mode</span>
    </button>
    <a href="kaart.html" class="btn-top nav-item"><span>ğŸ—ºï¸</span>AED Kaart</a>
</nav>

<script>
    let currentStep = 1;
    let atBreathingQuestion = false;
    const totalSteps = 9;
    
    const steps = [
        {
            title: "Controleer je eigen veiligheid",
            description: "Zorg dat je zelf veilig bent voordat je hulp biedt. Controleer omliggende gevaren."
        },
    
        {
            title: "Spreek het slachtoffer aan",
            description: "Probeer reactiviteit vast te stellen. Spreek luid en aanwijzingen. Schouder aanraken."
        },

        {
            title: "Bel 112 voor hulp",
            description: "Bel onmiddellijk 112. Zet op luidspreker. Wacht op instructies van de alarmcentrale."
        },

        {
            title: "Check de ademhaling",
            description: "Kijk, luister en voel of het slachtoffer ademt. Dit mag niet langer dan 10 seconden zijn.",
            isQuestion: true
        },
    
        {
            title: "Reanimatie Geven (CPR)",
            description: "<strong>30 borstcompressies:</strong> Plaats je handen op het midden van de borst. Duw met volle kracht 5-6cm diep, 100-120 per minuut. <strong>2 beademingen:</strong> Blow 2 keer kort in (als getraind). Herhaal dit ritme totdat de ambulance er is.",
            isReanimation: true
        },
        {
            title: "Zet in stabiele zijligging",
            description: "Als onbewust maar ademend: draai voorzichtig in de stabiele zijligging om verstikking te voorkomen."
        },
        {
            title: "Monitor de patiÃ«nt",
            description: "Blijf ademhaling controleren. Let op veranderingen. Zorg voor warmte en troost."
        },
        {
            title: "Bloeding stoppen",
            description: "Druk stevig op de wond met een schone doek of verband. Houd de druk vast en leg het gewonde lichaamsdeel indien mogelijk omhoog."
        },

        {
            title: "Wacht op hulpdiensten",
            description: "Blijf bij het slachtoffer tot hulpdiensten arriveren. Volg hun instructies op."
        }
    ];
    
    function displayStep() {
        const stepContainer = document.getElementById('stepContainer');
        const step = steps[currentStep - 1];
        
        stepContainer.innerHTML = `
            <div class="step-box">
                <p class="step-number">STAP ${currentStep}</p>
                <h3 class="step-title">${step.title}</h3>
                <p class="step-description">${step.description}</p>
            </div>
        `;
        
        updateButtonVisibility();
    }
    
    function updateButtonVisibility() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const breathingButtons = document.getElementById('breathingButtons');
        const step = steps[currentStep - 1];
        
        // Show/hide breathing question buttons
        if (step.isQuestion) {
            nextBtn.style.display = 'none';
            breathingButtons.style.display = 'block';
            prevBtn.style.display = 'inline-block';
            atBreathingQuestion = true;
        } else {
            nextBtn.style.display = 'inline-block';
            breathingButtons.style.display = 'none';
            atBreathingQuestion = false;
            nextBtn.innerText = currentStep === totalSteps ? 'Klaar!' : 'Check â†’';
            if (currentStep > 1) {
                prevBtn.style.display = 'inline-block';
            } else {
                prevBtn.style.display = 'none';
            }
        }
    }
    
    function breathingResult(isBreathing) {
        if (isBreathing) {
            // Patient is breathing - skip reanimation, go to recovery position
            currentStep = 6; // Zet in stabiele zijligging
        } else {
            // Patient is not breathing - go to reanimation
            currentStep = 5; // Reanimatie geven
        }
        displayStep();
    }
    
    function nextStep() {
        if (currentStep < totalSteps) {
            currentStep++;
            displayStep();
        } else if (currentStep === totalSteps) {
            alert('Je hebt alle kritieke stappen voltooid. Zorg dat je bij het slachtoffer blijft!');
        }
    }
    
    function previousStep() {
        if (currentStep > 1) {
            currentStep--;
            displayStep();
        }
    }
    
    // Taal en vertalingen
    let currentLang = localStorage.getItem('language') || 'nl';
    const translations = {
        nl:{train:'Trainen',call112:'ğŸ“ 112',home:'Home',flashlight:'Zaklamp',darkmode:'Donker',aedmap:'AED Kaart',infoTitle:'Noodhulp App â€” versie 1.0',infoBody:'Gebruik deze app voor EHBO snelhulp en navigatie.'},
        en:{train:'Training',call112:'ğŸ“ 112',home:'Home',flashlight:'Flashlight',darkmode:'Dark mode',aedmap:'AED Map',infoTitle:'Emergency App â€” v1.0',infoBody:'Use this app voor quick first aid and navigation.'},
        de:{train:'Training',call112:'ğŸ“ 112',home:'Start',flashlight:'Taschenlampe',darkmode:'Nachtmodus',aedmap:'AED Karte',infoTitle:'Notfall-App â€” v1.0',infoBody:'Verwenden Sie diese App fÃ¼r Erste Hilfe und Navigation.'},
        fr:{train:'EntraÃ®nement',call112:'ğŸ“ 112',home:'Accueil',flashlight:'Lampe de poche',darkmode:'Mode sombre',aedmap:'Carte AED',infoTitle:'Application dâ€™urgence â€” v1.0',infoBody:'Utilisez cette app pour les premiers secours et la navigation.'},
        es:{train:'Entrenamiento',call112:'ğŸ“ 112',home:'Inicio',flashlight:'Linterna',darkmode:'Modo oscuro',aedmap:'Mapa AED',infoTitle:'App de emergencia â€” v1.0',infoBody:'Usa esta app para primeros auxilios y navegaciÃ³n.'}
    };
    function applyTranslations(lang){
        const map=translations[lang]||translations['nl'];
        document.documentElement.lang=lang;
        document.querySelectorAll('[data-i18n]').forEach(el=>{
            const key=el.getAttribute('data-i18n');
            if(map[key]) el.textContent=map[key];
        });
    }
    const savedLang = localStorage.getItem('language') || currentLang;
    currentLang = savedLang;
    applyTranslations(currentLang);
    window.addEventListener('load', function(){
        const langSelect=document.getElementById('languageSelect');
        if(langSelect) langSelect.value=currentLang;
    });
    function changeLanguage(code){
        localStorage.setItem('language', code);
        currentLang=code;
        applyTranslations(code);
    }
    function showInfo(){
        const map=translations[currentLang]||translations['nl'];
        alert(map.infoTitle+"\n"+map.infoBody);
    }

    let flashlightStream = null;
    let flashlightTrack = null;

    // Herstel dark mode instellingen bij page load
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
    }
    if (localStorage.getItem('flashlight') === 'true') {
        document.body.style.filter = 'invert(1)';
    }

    function toggleDarkMode() { 
        document.body.classList.toggle("dark-mode");
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    async function toggleFlashlight() { 
        try {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('Zaklamp niet ondersteund op deze browser.');
                return;
            }

            if (flashlightTrack) {
                try {
                    await flashlightTrack.applyConstraints({ advanced: [{ torch: false }] });
                    flashlightTrack.stop();
                    flashlightStream.getTracks().forEach(track => track.stop());
                    flashlightTrack = null;
                    flashlightStream = null;
                } catch (e) {
                    console.error('Error turning off flashlight:', e);
                }
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        advanced: [{ torch: true }]
                    }
                });
                flashlightStream = stream;
                flashlightTrack = stream.getVideoTracks()[0];
            } catch (e) {
                console.log('Trying alternative method for flashlight...');
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities ? track.getCapabilities() : {};
                if (capabilities.torch) {
                    try {
                        await track.applyConstraints({ advanced: [{ torch: true }] });
                        flashlightStream = stream;
                        flashlightTrack = track;
                    } catch (constraintErr) {
                        track.stop();
                        stream.getTracks().forEach(t => t.stop());
                        alert('Zaklamp kan niet worden ingeschakeld op dit apparaat.');
                        return;
                    }
                } else {
                    track.stop();
                    stream.getTracks().forEach(t => t.stop());
                    alert('Zaklamp niet beschikbaar op dit apparaat.');
                    return;
                }
            }
        } catch (error) {
            console.error('Zaklamp fout:', error);
            if (error.name === 'NotAllowedError') {
                alert('Zaklamp toestemming geweigerd. Zet dit in je instellingen aan.');
            } else if (error.name === 'NotFoundError') {
                alert('Camera niet gevonden op dit apparaat.');
            } else {
                alert('Kan de zaklamp niet inschakelen. Mogelijke oorzaken: geen camera, geen toestemming, of onvoldoende Android versie (minimaal Android 5).');
            }
        }
    }
    
    // Start displaying first step
    displayStep();
</script>
</body>
</html>